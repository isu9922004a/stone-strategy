<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ÊòéÊòüÈ∫ªÂ∞á - È´òÊ∏ÖÂ§ßÂ≠óÁâà</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@900&display=swap');
        
        body { 
            margin: 0; 
            background: #000; 
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            height: 100vh;
            width: 100vw;
        }

        .game-wrapper {
            height: 100%;
            width: 100%;
            background: linear-gradient(to bottom, #1e3a8a 0%, #3b82f6 30%, #064e3b 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* 3D ÁâåÊ°å‰ΩàÂ±Ä */
        .table-area {
            perspective: 1200px;
            width: 100%;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: -5%;
        }

        .mahjong-table {
            width: 96vw;
            height: 55vh;
            background: radial-gradient(circle, #2d5a41 0%, #0f3d24 100%);
            border: 10px solid #5d3a1a;
            border-radius: 40px;
            transform: rotateX(30deg);
            box-shadow: 0 40px 80px rgba(0,0,0,0.7), inset 0 0 60px rgba(0,0,0,0.5);
            position: relative;
            display: flex;
            flex-wrap: wrap;
            align-content: center;
            justify-content: center;
            padding: 30px;
        }

        .npc-box {
            position: absolute;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .npc-avatar {
            width: 75px;
            height: 75px;
            border-radius: 15px;
            border: 3px solid #fbbf24;
            background: #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }

        /* --- È∫ªÂ∞áÁâå Ë¶ñË¶∫ÂçáÁ¥ö --- */
        .mj-tile {
            font-family: 'Noto Serif TC', serif;
            background: #fff;
            border-radius: 4px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            /* Ê®°Êì¨È∫ªÂ∞áÁöÑÁ∂†Ëâ≤ËÉåÊùø */
            box-shadow: 
                0 1px 0 #ccc,
                0 2px 0 #bbb,
                0 3px 0 #aaa,
                0 4px 0 #065f46; /* Á∂†Â∫ï */
        }
        
        /* ÊâãÁâåÔºöÊ•µÂ§ßÂåñËôïÁêÜ */
        .player-tile {
            width: calc(100vw / 17.5); /* ÂØ¨Â∫¶Áï•ÂæÆÂä†Â§ß */
            max-width: 46px;
            height: calc(1.45 * calc(100vw / 17.5));
            max-height: 66px;
            font-size: calc(100vw / 18); /* Â≠óÈ´îÊ•µÂ§ßÂåñ */
            margin: 0 1px;
            font-weight: 900;
        }

        .player-tile.selected {
            transform: translateY(-20px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 4px 0 #fbbf24;
            z-index: 10;
        }

        /* Ê°åÈù¢ÁâåÔºö‰πüÈÅ©Â∫¶Âä†Â§ß */
        .discard-tile {
            width: 26px;
            height: 36px;
            font-size: 22px;
            margin: 2px;
            box-shadow: 0 1px 0 #ccc, 0 2px 0 #065f46;
        }

        .bottom-ui {
            width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,1) 70%, rgba(0,0,0,0) 100%);
            padding: 10px 4px calc(10px + env(safe-area-inset-bottom));
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        .status-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 5px 15px;
            font-size: 13px;
            color: #fbbf24;
            font-weight: bold;
        }

        .btn-action {
            background: linear-gradient(to bottom, #fcd34d, #d97706);
            border: 2px solid #78350f;
            color: #000;
            padding: 6px 24px;
            border-radius: 8px;
            font-weight: 900;
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
            box-shadow: 0 4px 0 #78350f;
        }
        .btn-action:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #78350f;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const TILE_SYMBOLS = ['üÄá','üÄà','üÄâ','üÄä','üÄã','üÄå','üÄç','üÄé','üÄè','üÄô','üÄö','üÄõ','üÄú','üÄù','üÄû','üÄü','üÄ†','üÄ°','üÄê','üÄë','üÄí','üÄì','üÄî','üÄï','üÄñ','üÄó','üÄò','üÄÄ','üÄÅ','üÄÇ','üÄÉ','üÄÑ','üÄÖ','üÄÜ'];

        const App = () => {
            const [deck, setDeck] = useState([]);
            const [players, setPlayers] = useState([
                { name: 'ÊàëÊòØ‰∏ÉÂÖ≠', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Me' },
                { name: 'ÊÜ≤Âì•', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix' },
                { name: 'ÁæéÈ≥≥Âßê', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Lily' },
                { name: '‰πÉÂì•', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka' }
            ]);
            const [turn, setTurn] = useState(0);
            const [selectedIdx, setSelectedIdx] = useState(null);

            const initGame = () => {
                let d = []; for(let i=0; i<34; i++) for(let j=0; j<4; j++) d.push(i);
                d.sort(() => Math.random() - 0.5);
                const p = [...players];
                p.forEach(player => {
                    player.hand = d.splice(0, 16).sort((a,b)=>a-b);
                    player.discards = [];
                });
                setDeck(d); setPlayers(p); setTurn(0);
                drawTile(0, p, d);
            };

            const drawTile = (idx, curP, curD) => {
                if (curD.length === 0) return;
                const nextD = [...curD];
                const tile = nextD.shift();
                const nextP = [...curP];
                nextP[idx].hand.push(tile);
                setDeck(nextD); setPlayers(nextP);
                if (idx !== 0) setTimeout(() => discard(idx, nextP[idx].hand.length-1, nextP, nextD), 1200);
            };

            const discard = (idx, tIdx, curP, curD) => {
                const nextP = [...curP];
                const tile = nextP[idx].hand.splice(tIdx, 1)[0];
                nextP[idx].discards.push(tile);
                nextP[idx].hand.sort((a,b)=>a-b);
                setPlayers(nextP); setSelectedIdx(null);
                const nextTurn = (idx + 1) % 4;
                setTurn(nextTurn);
                setTimeout(() => drawTile(nextTurn, nextP, curD), 600);
            };

            useEffect(() => { initGame(); }, []);

            return (
                <div className="game-wrapper">
                    {/* ‰∏äÊñπ NPC */}
                    <div className="npc-box top-4">
                        <img src={players[2].avatar} className={`npc-avatar ${turn===2?'ring-4 ring-yellow-400':''}`} />
                        <span className="text-xs text-white font-bold mt-1 drop-shadow-md">{players[2].name}</span>
                    </div>

                    {/* Â∑¶Âè≥ NPC */}
                    <div className="npc-box left-4 top-[35%]">
                        <img src={players[1].avatar} className={`npc-avatar ${turn===1?'ring-4 ring-yellow-400':''}`} />
                        <span className="text-xs text-white font-bold mt-1 drop-shadow-md">{players[1].name}</span>
                    </div>
                    <div className="npc-box right-4 top-[35%]">
                        <img src={players[3].avatar} className={`npc-avatar ${turn===3?'ring-4 ring-yellow-400':''}`} />
                        <span className="text-xs text-white font-bold mt-1 drop-shadow-md">{players[3].name}</span>
                    </div>

                    {/* ÁâåÊ°åÂçÄ */}
                    <div className="table-area">
                        <div className="mahjong-table">
                            <div className="flex flex-wrap justify-center content-center w-full h-full max-w-[80%]">
                                {players.flatMap(p => p.discards).map((t, i) => (
                                    <div key={i} className={`mj-tile discard-tile ${t<=8||t===31?'text-red-600':'text-green-800'}`}>{TILE_SYMBOLS[t]}</div>
                                ))}
                            </div>
                            <div className="absolute top-4 left-6 text-sm text-yellow-400 font-black drop-shadow-md">Ââ©È§ò: {deck.length}</div>
                        </div>
                    </div>

                    {/* Â∫ïÈÉ® UI */}
                    <div className="bottom-ui">
                        <div className="flex gap-6 mb-4">
                            {turn === 0 && (
                                <>
                                    <button onClick={() => selectedIdx !== null && discard(0, selectedIdx, players, deck)} 
                                        className="btn-action">Âá∫ Áâå</button>
                                    <button className="btn-action grayscale opacity-50">ËÉ° Áâå</button>
                                </>
                            )}
                        </div>
                        
                        <div className="flex justify-center w-full px-2 mb-4">
                            {players[0].hand.map((id, i) => (
                                <div key={i} 
                                    onClick={() => turn === 0 && setSelectedIdx(i)}
                                    className={`mj-tile player-tile ${id<=8||id===31?'text-red-600':'text-green-800'} ${selectedIdx===i?'selected':''}`}>
                                    {TILE_SYMBOLS[id]}
                                </div>
                            ))}
                        </div>

                        <div className="status-bar">
                            <div className="flex items-center gap-2">
                                <span className="bg-green-600 text-white px-1 rounded">Êù±</span>
                                <span>ÊàëÊòØ‰∏ÉÂÖ≠</span>
                            </div>
                            <div className="flex gap-4">
                                <span>üí∞ 9,930</span>
                                <span className="text-white/70 font-normal">Lv.12 È∫ªÂ∞áÂÖ•ÈñÄ</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

