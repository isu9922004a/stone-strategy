<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜æ˜Ÿéº»å°‡ - ç¶“å…¸å¤§é ­ç‰ˆ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@900&display=swap');
        
        body { 
            margin: 0; 
            background: #000; 
            overflow: hidden; 
            font-family: 'Microsoft JhengHei', sans-serif;
        }

        /* æ¨¡æ“¬åœ–ç‰‡ä¸­çš„çª—å¤–èƒŒæ™¯ */
        .game-background {
            background: linear-gradient(to bottom, #1a3a5a 0%, #4a90e2 40%, #062012 100%);
            height: 100vh;
            width: 100vw;
            position: absolute;
            z-index: -2;
        }

        /* 3D ç‰Œæ¡Œé€è¦–æ•ˆæœ */
        .table-container {
            perspective: 1000px;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mahjong-table {
            width: 90vw;
            height: 65vh;
            background: radial-gradient(circle, #2d5a41 0%, #1a3a2a 100%);
            border: 12px solid #5d3a1a;
            border-radius: 40px;
            transform: rotateX(25deg);
            box-shadow: 0 50px 100px rgba(0,0,0,0.8), inset 0 0 50px rgba(0,0,0,0.5);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* è§’è‰²å¤§é ­è²¼ */
        .avatar-box {
            position: absolute;
            display: flex;
            flex-col: column;
            align-items: center;
            z-index: 50;
        }
        .avatar-img {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            background: #eee;
            border: 3px solid #fcd34d;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
        }

        /* éº»å°‡ç‰Œæ¨£å¼å„ªåŒ– */
        .mj-tile {
            font-family: 'Noto Serif TC', serif;
            background: linear-gradient(to bottom, #fff 0%, #f0f0f0 100%);
            border-radius: 4px;
            border: 1px solid #ccc;
            border-bottom: 4px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .mj-tile.player { width: 44px; height: 60px; font-size: 40px; }
        .mj-tile.discard { width: 30px; height: 42px; font-size: 24px; margin: 1px; }
        .mj-tile:active { transform: translateY(2px); }
        .mj-tile.selected { transform: translateY(-15px); border-color: #fbbf24; border-bottom-width: 8px; }

        /* åº•éƒ¨æ“ä½œåˆ— */
        .control-bar {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 120px;
            background: linear-gradient(to top, #000 0%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .info-panel {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 5px 15px;
            border-radius: 5px;
            border: 1px solid #444;
            color: #fff;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        const TILE_SYMBOLS = ['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€','ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡','ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜','ğŸ€€','ğŸ€','ğŸ€‚','ğŸ€ƒ','ğŸ€„','ğŸ€…','ğŸ€†'];
        
        const CHARACTERS = [
            { name: 'æˆ‘æ˜¯ä¸ƒå…­', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Me', role: 'player' },
            { name: 'æ†²å“¥', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix', quote: 'è¦‹é¬¼å•¦ï¼' },
            { name: 'ä¹ƒå“¥', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka', quote: 'æˆ‘ä¸éŒ„äº†ï¼' },
            { name: 'ç¾é³³å§', avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Lily', quote: 'é€™å¼µæ°´å–”ï½' }
        ];

        const App = () => {
            const [deck, setDeck] = useState([]);
            const [players, setPlayers] = useState(CHARACTERS.map((c, i) => ({ ...c, id: i, hand: [], discards: [] })));
            const [turn, setTurn] = useState(0);
            const [selectedIdx, setSelectedIdx] = useState(null);
            const [gameMsg, setGameMsg] = useState("éº»å°‡å…¥é–€ - èŠå®¶æº–å‚™é–‹ç‰Œ");

            const initGame = () => {
                let d = []; for(let i=0; i<34; i++) for(let j=0; j<4; j++) d.push(i);
                d.sort(() => Math.random() - 0.5);
                const nextPlayers = CHARACTERS.map((c, i) => ({ 
                    ...c, 
                    id: i, 
                    hand: d.splice(0, 16).sort((a,b)=>a-b), 
                    discards: [] 
                }));
                setDeck(d); setPlayers(nextPlayers); setTurn(0);
                drawTile(0, nextPlayers, d);
            };

            const drawTile = (pIdx, curPlayers, curDeck) => {
                if (curDeck.length <= 0) return;
                const nextDeck = [...curDeck];
                const tile = nextDeck.shift();
                const nextPlayers = [...curPlayers];
                nextPlayers[pIdx].hand.push(tile);
                setDeck(nextDeck); setPlayers(nextPlayers);

                if (pIdx !== 0) {
                    setTimeout(() => handleDiscard(pIdx, nextPlayers[pIdx].hand.length - 1, nextPlayers, nextDeck), 1500);
                }
            };

            const handleDiscard = (pIdx, tileIdx, curPlayers, curDeck) => {
                const nextPlayers = [...curPlayers];
                const tile = nextPlayers[pIdx].hand.splice(tileIdx, 1)[0];
                nextPlayers[pIdx].discards.push(tile);
                nextPlayers[pIdx].hand.sort((a,b)=>a-b);
                setPlayers(nextPlayers); setSelectedIdx(null);

                const nextTurn = (pIdx + 1) % 4;
                setTurn(nextTurn);
                setTimeout(() => drawTile(nextTurn, nextPlayers, curDeck), 500);
            };

            useEffect(() => { initGame(); }, []);

            return (
                <div className="game-background overflow-hidden flex flex-col items-center justify-center">
                    {/* ä¸Šæ–¹è§’è‰² */}
                    <div className="absolute top-10 flex flex-col items-center">
                        <img src={players[2].avatar} className={`avatar-img ${turn===2?'ring-4 ring-yellow-400':''}`} />
                        <div className="bg-yellow-600 px-2 text-xs mt-1 text-white rounded">ç¾é³³å§</div>
                    </div>

                    {/* å…©å´è§’è‰² */}
                    <div className="absolute left-10 top-1/2 -translate-y-1/2 flex flex-col items-center">
                        <img src={players[1].avatar} className={`avatar-img ${turn===1?'ring-4 ring-yellow-400':''}`} />
                        <div className="bg-yellow-600 px-2 text-xs mt-1 text-white rounded">æ†²å“¥</div>
                    </div>
                    <div className="absolute right-10 top-1/2 -translate-y-1/2 flex flex-col items-center">
                        <img src={players[3].avatar} className={`avatar-img ${turn===3?'ring-4 ring-yellow-400':''}`} />
                        <div className="bg-yellow-600 px-2 text-xs mt-1 text-white rounded">ä¹ƒå“¥</div>
                    </div>

                    {/* ç‰Œæ¡Œå€ */}
                    <div className="table-container">
                        <div className="mahjong-table">
                            <div className="w-full h-full p-12 flex flex-wrap content-center justify-center">
                                {players.flatMap(p => p.discards).map((t, i) => (
                                    <div key={i} className={`mj-tile discard ${t<=8||t===31?'text-red-600':'text-green-800'}`}>
                                        {TILE_SYMBOLS[t]}
                                    </div>
                                ))}
                            </div>
                            
                            {/* å‰©é¤˜å¼µæ•¸å°ç›’ */}
                            <div className="absolute top-4 left-4 bg-black/50 text-yellow-400 p-2 border border-white/20 rounded">
                                <span className="text-xs">å‰©é¤˜:</span> {deck.length}
                            </div>
                        </div>
                    </div>

                    {/* ç©å®¶æ‰‹ç‰Œå€ */}
                    <div className="control-bar flex flex-col gap-2">
                        {turn === 0 && (
                            <div className="flex gap-4 mb-2">
                                <button onClick={() => selectedIdx !== null && handleDiscard(0, selectedIdx, players, deck)} 
                                    className="bg-yellow-500 hover:bg-yellow-400 text-black px-8 py-1 rounded font-black shadow-lg">å‡ºç‰Œ</button>
                                <button className="bg-red-600 text-white px-8 py-1 rounded font-black shadow-lg">èƒ¡ç‰Œ</button>
                            </div>
                        )}
                        <div className="flex gap-1">
                            {players[0].hand.map((id, i) => (
                                <div key={i} 
                                    onClick={() => turn === 0 && setSelectedIdx(i)}
                                    className={`mj-tile player ${id<=8||id===31?'text-red-600':'text-green-800'} ${selectedIdx===i?'selected':''}`}>
                                    {TILE_SYMBOLS[id]}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* åº•éƒ¨è³‡è¨Šåˆ— */}
                    <div className="info-panel flex gap-8 items-center">
                        <div className="text-green-400 font-bold">æ±</div>
                        <div>{players[0].name}</div>
                        <div className="text-yellow-400 font-bold">Lv.12</div>
                        <div className="text-yellow-300">ğŸ’° 9,930</div>
                        <div className="bg-white/20 px-2 rounded ml-10 text-xs">{gameMsg}</div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

