<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ˜æ˜Ÿéº»å°‡ - ç¶“å…¸æ‰‹éŠç‰ˆ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@900&display=swap');
        
        body { 
            margin: 0; 
            background: #000; 
            overflow: hidden; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            height: 100vh;
            width: 100vw;
        }

        /* æ¨¡æ“¬åœ–ç‰‡ä¸­çš„èƒŒæ™¯ */
        .game-wrapper {
            height: 100%;
            width: 100%;
            background: linear-gradient(to bottom, #1e3a8a 0%, #3b82f6 30%, #064e3b 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* 3D ç‰Œæ¡Œ - é‡å°æ‰‹æ©Ÿæ¯”ä¾‹å„ªåŒ– */
        .table-area {
            perspective: 1200px;
            width: 100%;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: -10%; /* å¾€ä¸Šç§»ä¸€é»é¿é–‹åº•æ¬„ */
        }

        .mahjong-table {
            width: 95vw;
            height: 50vh;
            background: radial-gradient(circle, #2d5a41 0%, #14532d 100%);
            border: 8px solid #78350f;
            border-radius: 30px;
            transform: rotateX(35deg); /* èª¿æ•´è§’åº¦é˜²æ­¢å¤ªé•· */
            box-shadow: 0 30px 60px rgba(0,0,0,0.6), inset 0 0 40px rgba(0,0,0,0.4);
            position: relative;
            display: flex;
            flex-wrap: wrap;
            align-content: center;
            justify-content: center;
            padding: 20px;
        }

        /* è§’è‰²é ­åƒ - è²¼è¿‘æ¡Œç·£ */
        .npc-box {
            position: absolute;
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .npc-avatar {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            border: 2px solid #fbbf24;
            background: #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* éº»å°‡ç‰Œ */
        .mj-tile {
            font-family: 'Noto Serif TC', serif;
            background: white;
            border-radius: 3px;
            border: 1px solid #d1d5db;
            border-bottom: 3px solid #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
            transition: transform 0.1s;
        }
        
        /* æ‰‹ç‰Œï¼šæ ¹æ“šè¢å¹•å¯¬åº¦è‡ªå‹•è¨ˆç®—å¤§å° */
        .player-tile {
            width: calc(100vw / 18);
            max-width: 40px;
            height: calc(1.4 * calc(100vw / 18));
            max-height: 56px;
            font-size: calc(100vw / 22);
            margin: 0 1px;
        }
        .player-tile.selected {
            transform: translateY(-12px);
            border-bottom-width: 6px;
            border-color: #fbbf24;
        }

        /* ä¸Ÿå‡ºçš„ç‰Œ */
        .discard-tile {
            width: 22px;
            height: 30px;
            font-size: 18px;
            margin: 1px;
        }

        /* åº•éƒ¨ UI */
        .bottom-ui {
            width: 100%;
            background: rgba(0,0,0,0.85);
            padding: 8px 4px env(safe-area-inset-bottom);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        .status-bar {
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 2px 12px;
            font-size: 12px;
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const TILE_SYMBOLS = ['ğŸ€‡','ğŸ€ˆ','ğŸ€‰','ğŸ€Š','ğŸ€‹','ğŸ€Œ','ğŸ€','ğŸ€','ğŸ€','ğŸ€™','ğŸ€š','ğŸ€›','ğŸ€œ','ğŸ€','ğŸ€','ğŸ€Ÿ','ğŸ€ ','ğŸ€¡','ğŸ€','ğŸ€‘','ğŸ€’','ğŸ€“','ğŸ€”','ğŸ€•','ğŸ€–','ğŸ€—','ğŸ€˜','ğŸ€€','ğŸ€','ğŸ€‚','ğŸ€ƒ','ğŸ€„','ğŸ€…','ğŸ€†'];

        const App = () => {
            const [deck, setDeck] = useState([]);
            const [players, setPlayers] = useState([
                { name: 'æˆ‘æ˜¯ä¸ƒå…­', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Me' },
                { name: 'æ†²å“¥', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix' },
                { name: 'ç¾é³³å§', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Lily' },
                { name: 'ä¹ƒå“¥', hand: [], discards: [], avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka' }
            ]);
            const [turn, setTurn] = useState(0);
            const [selectedIdx, setSelectedIdx] = useState(null);

            const initGame = () => {
                let d = []; for(let i=0; i<34; i++) for(let j=0; j<4; j++) d.push(i);
                d.sort(() => Math.random() - 0.5);
                const p = [...players];
                p.forEach(player => {
                    player.hand = d.splice(0, 16).sort((a,b)=>a-b);
                    player.discards = [];
                });
                setDeck(d); setPlayers(p); setTurn(0);
                drawTile(0, p, d);
            };

            const drawTile = (idx, curP, curD) => {
                if (curD.length === 0) return;
                const nextD = [...curD];
                const tile = nextD.shift();
                const nextP = [...curP];
                nextP[idx].hand.push(tile);
                setDeck(nextD); setPlayers(nextP);
                if (idx !== 0) setTimeout(() => discard(idx, nextP[idx].hand.length-1, nextP, nextD), 1000);
            };

            const discard = (idx, tIdx, curP, curD) => {
                const nextP = [...curP];
                const tile = nextP[idx].hand.splice(tIdx, 1)[0];
                nextP[idx].discards.push(tile);
                nextP[idx].hand.sort((a,b)=>a-b);
                setPlayers(nextP); setSelectedIdx(null);
                const nextTurn = (idx + 1) % 4;
                setTurn(nextTurn);
                setTimeout(() => drawTile(nextTurn, nextP, curD), 500);
            };

            useEffect(() => { initGame(); }, []);

            return (
                <div className="game-wrapper">
                    {/* ä¸Šæ–¹ NPC */}
                    <div className="npc-box top-4">
                        <img src={players[2].avatar} className={`npc-avatar ${turn===2?'ring-4 ring-yellow-400':''}`} />
                        <span className="text-[10px] text-white bg-black/50 px-1 rounded">{players[2].name}</span>
                    </div>

                    {/* å·¦å³ NPC */}
                    <div className="npc-box left-2 top-[35%]">
                        <img src={players[1].avatar} className={`npc-avatar ${turn===1?'ring-4 ring-yellow-400':''}`} />
                        <span className="text-[10px] text-white bg-black/50 px-1 rounded">{players[1].name}</span>
                    </div>
                    <div className="npc-box right-2 top-[35%]">
                        <img src={players[3].avatar} className={`npc-avatar ${turn===3?'ring-4 ring-yellow-400':''}`} />
                        <span className="text-[10px] text-white bg-black/50 px-1 rounded">{players[3].name}</span>
                    </div>

                    {/* ç‰Œæ¡Œå€ */}
                    <div className="table-area">
                        <div className="mahjong-table">
                            {players.flatMap(p => p.discards).map((t, i) => (
                                <div key={i} className={`mj-tile discard-tile ${t<=8||t===31?'text-red-600':'text-green-800'}`}>{TILE_SYMBOLS[t]}</div>
                            ))}
                            <div className="absolute top-2 left-2 text-[10px] text-yellow-500 font-bold">å‰©é¤˜: {deck.length}</div>
                        </div>
                    </div>

                    {/* åº•éƒ¨ UI èˆ‡æ‰‹ç‰Œ */}
                    <div className="bottom-ui">
                        <div className="flex gap-4 mb-3">
                            {turn === 0 && (
                                <>
                                    <button onClick={() => selectedIdx !== null && discard(0, selectedIdx, players, deck)} 
                                        className="bg-yellow-500 px-6 py-1 rounded text-sm font-bold text-black shadow-lg active:scale-90">å‡ºç‰Œ</button>
                                    <button className="bg-red-600 px-6 py-1 rounded text-sm font-bold text-white shadow-lg opacity-50">èƒ¡ç‰Œ</button>
                                </>
                            )}
                        </div>
                        
                        <div className="flex justify-center w-full px-1 mb-2">
                            {players[0].hand.map((id, i) => (
                                <div key={i} 
                                    onClick={() => turn === 0 && setSelectedIdx(i)}
                                    className={`mj-tile player-tile ${id<=8||id===31?'text-red-600':'text-green-800'} ${selectedIdx===i?'selected':''}`}>
                                    {TILE_SYMBOLS[id]}
                                </div>
                            ))}
                        </div>

                        <div className="status-bar">
                            <div className="flex gap-3">
                                <span className="text-green-500 font-bold">æ±</span>
                                <span>æˆ‘æ˜¯ä¸ƒå…­</span>
                            </div>
                            <div className="flex gap-3">
                                <span>ğŸ’° 9,930</span>
                                <span className="text-white/50">Lv.12 éº»å°‡å…¥é–€</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

