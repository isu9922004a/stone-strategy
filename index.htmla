<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è–åŠçŸ³ (Excalibur-Stone) é›™åˆ€æµæˆ°è¡“æ§åˆ¶å°</title>
<style>
    :root {
        --bg-main: #0b1120;
        --bg-card: #1e293b;
        --bg-input: #334155;
        --text-main: #f1f5f9;
        --text-sub: #94a3b8;
        --accent-blue: #38bdf8;
        --accent-green: #22c55e;
        --accent-red: #ef4444;
        --accent-yellow: #eab308;
        --border: #475569;
    }
    body {
        font-family: 'Segoe UI', Microsoft JhengHei, sans-serif;
        background-color: var(--bg-main);
        color: var(--text-main);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .container {
        width: 100%;
        max-width: 1200px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    @media (max-width: 768px) {
        .container { grid-template-columns: 1fr; }
    }
    .header {
        width: 100%;
        max-width: 1200px;
        border-bottom: 2px solid var(--accent-blue);
        margin-bottom: 20px;
        padding-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: end;
    }
    .header h1 { margin: 0; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 1px; }
    .header span { font-size: 0.9em; color: var(--text-sub); }
    .card {
        background-color: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    h2 { color: var(--accent-blue); font-size: 1.2rem; border-left: 4px solid var(--accent-blue); padding-left: 10px; margin-top: 0; }
    h3 { font-size: 1rem; color: var(--text-sub); margin-bottom: 10px; border-bottom: 1px solid var(--border); padding-bottom: 5px; }
    /* Input Fields */
    .input-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-sub); }
    input[type="number"], input[type="text"], select {
        width: 100%;
        padding: 10px;
        background: var(--bg-input);
        border: 1px solid var(--border);
        color: white;
        border-radius: 4px;
        box-sizing: border-box;
    }
    /* Checkbox Group */
    .checkbox-group { display: flex; flex-direction: column; gap: 8px; }
    .checkbox-item { display: flex; align-items: center; gap: 10px; cursor: pointer; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 4px; }
    .checkbox-item:hover { background: rgba(255,255,255,0.05); }
    /* Image Upload */
    .upload-area {
        border: 2px dashed var(--border);
        padding: 20px;
        text-align: center;
        cursor: pointer;
        margin-bottom: 15px;
        transition: 0.3s;
    }
    .upload-area:hover { border-color: var(--accent-blue); background: rgba(56, 189, 248, 0.05); }
    #preview-img { max-width: 100%; display: none; margin-top: 10px; border-radius: 4px; border: 1px solid var(--border); }
    /* Results Grid */
    .results-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 5px;
        margin-top: 10px;
        text-align: center;
    }
    .res-box { padding: 10px 5px; background: #0f172a; border-radius: 4px; border: 1px solid var(--border); }
    .res-val { font-size: 1.1rem; font-weight: bold; color: white; }
    .res-label { font-size: 0.75rem; color: var(--text-sub); }
    /* Status Lights */
    .status-badge {
        display: inline-block;
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: bold;
        text-transform: uppercase;
        margin-top: 10px;
        width: 100%;
        text-align: center;
    }
    .status-green { background: rgba(34, 197, 94, 0.2); color: var(--accent-green); border: 1px solid var(--accent-green); }
    .status-yellow { background: rgba(234, 179, 8, 0.2); color: var(--accent-yellow); border: 1px solid var(--accent-yellow); }
    .status-red { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); border: 1px solid var(--accent-red); }
    /* Output Area */
    .output-area {
        width: 100%;
        height: 300px;
        background: #000;
        color: #0f0;
        font-family: 'Courier New', monospace;
        padding: 15px;
        border: 1px solid var(--border);
        resize: vertical;
        box-sizing: border-box;
    }
    button {
        background: linear-gradient(90deg, #2563eb, #1d4ed8);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        width: 100%;
        margin-top: 10px;
        transition: 0.2s;
    }
    button:hover { filter: brightness(1.1); }
    button.secondary { background: var(--bg-input); color: var(--text-sub); }
</style>
</head>
<body>
    <div class="header">
        <h1>è–åŠçŸ³æˆ°è¡“æ§åˆ¶å°</h1>
        <span>VER 2.0 | EXCALIBUR-STONE SYSTEM</span>
    </div>
    <div class="container">
        <div class="left-col">
            <div class="card">
                <h2>1. åœ–åƒæƒ…å ± (Visual Intel)</h2>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <span id="upload-text">é»æ“Šä¸Šå‚³ Kç·šåœ–/ç±Œç¢¼æˆªåœ– ä»¥ä¾›å°ç…§</span>
                    <input type="file" id="fileInput" accept="image/*" style="display: none" onchange="previewImage(event)">
                </div>
                <img id="preview-img" src="" alt="Stock Chart Preview">
            </div>
            <div class="card" style="margin-top: 20px;">
                <h2>2. åƒ¹æ ¼åƒæ•¸ (CDP Input)</h2>
                <div class="input-group">
                    <label>è‚¡ç¥¨ä»£è™Ÿ/åç¨±</label>
                    <input type="text" id="stockName" placeholder="ä¾‹å¦‚ï¼š2330 å°ç©é›»">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label>æ˜¨æ—¥é«˜ (H)</label>
                        <input type="number" id="priceH" step="0.01" oninput="calculateCDP()">
                    </div>
                    <div class="input-group">
                        <label>æ˜¨æ—¥ä½ (L)</label>
                        <input type="number" id="priceL" step="0.01" oninput="calculateCDP()">
                    </div>
                    <div class="input-group">
                        <label>æ˜¨æ—¥æ”¶ (C)</label>
                        <input type="number" id="priceC" step="0.01" oninput="calculateCDP()">
                    </div>
                </div>
            </div>
            <div class="card" style="margin-top: 20px;">
                <h2>3. æˆ°ç•¥æª¢æ ¸ (Checklist)</h2>
                <h3>ç¬¬ä¸€åŠï¼šåŸºæœ¬é¢</h3>
                <div class="input-group">
                    <label>ç‡Ÿæ¥­ç¾é‡‘æµç‹€æ…‹</label>
                    <select id="sword1" onchange="updateStatus()">
                        <option value="pass">åˆæ ¼ (æ­£æ•¸ +)</option>
                        <option value="fail">ä¸åˆæ ¼ (è² æ•¸ -)</option>
                    </select>
                </div>
                <h3>ç¬¬äºŒåŠï¼šç±Œç¢¼çµæ§‹</h3>
                <div class="input-group">
                    <label>å¤–è³‡ vs å…§è³‡å‹•å‘</label>
                    <select id="sword2" onchange="updateStatus()">
                        <option value="sync">é›™åŠåˆç’§ (å¤–è³‡å¢ / å…§è³‡å¢)</option>
                        <option value="foreign_heavy">å¤–è³‡ç¨æ’ (å¤–è³‡ > 50%)</option>
                        <option value="internal_sell">å±éšªè¨Šè™Ÿ (å¤–è³‡å¢ / å…§è³‡å€’è²¨)</option>
                        <option value="messy">ç±Œç¢¼æ¸™æ•£ (ç„¡å¤§äººé¡§)</option>
                    </select>
                </div>
                <h3>ç¬¬ä¸‰åŠ & é¢¨éšªåˆ¤å®š</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="hasBig3" onchange="updateStatus()">
                        <span>å‡ºç¾ä¸‰å¤§çœŸä¸»åŠ› (å¤§æ‘©/é«˜ç››/ç‘éŠ€)</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="hasHighRisk" onchange="updateStatus()">
                        <span style="color:var(--accent-red)">å‡ºç¾é«˜é¢¨éšªä¸»åŠ› (éš”æ—¥æ²–/å‡å¤–è³‡/è™å°¾å¹«)</span>
                    </label>
                </div>
                <div class="input-group" style="margin-top:10px;">
                    <label>é—œéµåˆ¸å•†å‚™è¨» (é¸å¡«)</label>
                    <input type="text" id="brokerNotes" placeholder="ä¾‹ï¼šå‡±åŸºå°åŒ—å¤§è²·ã€å…ƒå¤§åœŸåŸè³£è¶…">
                </div>
            </div>
        </div>
        <div class="right-col">
            <div class="card">
                <h2>4. çŸ³é ­æˆ°æ³•ç¶²æ ¼ (Tactical Grid)</h2>
                <div class="results-grid">
                    <div class="res-box" style="border-color: var(--accent-red);">
                        <div class="res-label">AH (å£“)</div>
                        <div class="res-val" id="val-ah">--</div>
                    </div>
                    <div class="res-box" style="border-color: var(--accent-green);">
                        <div class="res-label">NH (è¿½)</div>
                        <div class="res-val" id="val-nh">--</div>
                    </div>
                    <div class="res-box" style="border-color: var(--accent-blue);">
                        <div class="res-label">CDP (ä¸­)</div>
                        <div class="res-val" id="val-cdp">--</div>
                    </div>
                    <div class="res-box">
                        <div class="res-label">NL (æ’)</div>
                        <div class="res-val" id="val-nl">--</div>
                    </div>
                    <div class="res-box">
                        <div class="res-label">AL (åœ)</div>
                        <div class="res-val" id="val-al">--</div>
                    </div>
                </div>
                <div id="status-indicator" class="status-badge status-yellow">ç­‰å¾…è¼¸å…¥æ•¸æ“š...</div>
            </div>
            <div class="card" style="margin-top: 20px;">
                <h2>5. è¨ºæ–·å ±å‘Šè¼¸å‡º (Report)</h2>
                <textarea id="outputReport" class="output-area" readonly></textarea>
                <div style="display:flex; gap:10px;">
                    <button onclick="generateReport()">ç”Ÿæˆè¨ºæ–·å ±å‘Š</button>
                    <button class="secondary" onclick="copyReport()">è¤‡è£½å ±å‘Š</button>
                </div>
            </div>
        </div>
    </div>
<script>
    // 1. Image Preview Logic
    function previewImage(event) {
        var reader = new FileReader();
        reader.onload = function(){
            var output = document.getElementById('preview-img');
            output.src = reader.result;
            output.style.display = 'block';
            document.getElementById('upload-text').innerText = "åœ–ç‰‡å·²è¼‰å…¥";
        };
        reader.readAsDataURL(event.target.files[0]);
    }
    // 2. CDP Calculation Logic
    function calculateCDP() {
        let H = parseFloat(document.getElementById('priceH').value);
        let L = parseFloat(document.getElementById('priceL').value);
        let C = parseFloat(document.getElementById('priceC').value);
        if (isNaN(H) || isNaN(L) || isNaN(C)) return;
        // User Formula: CDP = (H + L + C) / 4
        let cdp = (H + L + C) / 4;
        let ah = cdp + (H - L);
        let nh = cdp * 2 - L;
        let nl = cdp * 2 - H;
        let al = cdp - (H - L);
        document.getElementById('val-cdp').innerText = cdp.toFixed(2);
        document.getElementById('val-ah').innerText = ah.toFixed(2);
        document.getElementById('val-nh').innerText = nh.toFixed(2);
        document.getElementById('val-nl').innerText = nl.toFixed(2);
        document.getElementById('val-al').innerText = al.toFixed(2);
        updateStatus(); // Update status when price changes
    }
    // 3. Status Logic (Traffic Light)
    function updateStatus() {
        let s1 = document.getElementById('sword1').value; // pass, fail
        let s2 = document.getElementById('sword2').value; // sync, foreign_heavy, internal_sell, messy
        let big3 = document.getElementById('hasBig3').checked;
        let highRisk = document.getElementById('hasHighRisk').checked;
        let indicator = document.getElementById('status-indicator');
        let statusText = "";
        let statusClass = "";
        // Logic based on prompt
        if (s1 === 'fail' || s2 === 'internal_sell' || s2 === 'messy') {
            // RED LIGHT
            statusText = "ğŸ”´ ç´…ç‡ˆ (æ’¤é€€/åç©º) - åš´å®ˆ NL";
            statusClass = "status-red";
        } else if (highRisk) {
            // YELLOW LIGHT (High risk broker present)
            statusText = "ğŸŸ¡ é»ƒç‡ˆ (éœ‡ç›ª/è­¦æˆ’) - éš”æ—¥æ²–å¹²æ“¾";
            statusClass = "status-yellow";
        } else if (s1 === 'pass' && (s2 === 'sync' || s2 === 'foreign_heavy') && big3) {
            // GREEN LIGHT (Perfect)
            statusText = "ğŸŸ¢ ç¶ ç‡ˆ (é€²æ”»/åå¤š) - è¶¨å‹¢ç¢ºç«‹";
            statusClass = "status-green";
        } else {
            // Default to Yellow (Mixed signals)
            statusText = "ğŸŸ¡ é»ƒç‡ˆ (éœ‡ç›ª/è§€å¯Ÿ) - è¨Šè™Ÿæœªæ»¿";
            statusClass = "status-yellow";
        }
        indicator.className = "status-badge " + statusClass;
        indicator.innerText = statusText;
        indicator.dataset.light = statusText.substring(0, 1); // Store emoji for report
    }
    // 4. Report Generation Logic
    function generateReport() {
        let name = document.getElementById('stockName').value || "æœªçŸ¥è‚¡è™Ÿ";
        let H = document.getElementById('priceH').value;
        let cdp = document.getElementById('val-cdp').innerText;
        if (cdp === "--") {
            alert("è«‹å…ˆè¼¸å…¥åƒ¹æ ¼æ•¸æ“š (H/L/C)");
            return;
        }
        let ah = document.getElementById('val-ah').innerText;
        let nh = document.getElementById('val-nh').innerText;
        let nl = document.getElementById('val-nl').innerText;
        let al = document.getElementById('val-al').innerText;
        let s1 = document.getElementById('sword1');
        let s2 = document.getElementById('sword2');
        let big3 = document.getElementById('hasBig3').checked;
        let highRisk = document.getElementById('hasHighRisk').checked;
        let brokerNotes = document.getElementById('brokerNotes').value || "ç„¡ç‰¹åˆ¥æ¨™è¨»";
        let indicator = document.getElementById('status-indicator');
        // Logic Translation
        let s1Text = s1.value === 'pass' ? "æ­£æ•¸ -> åˆæ ¼" : "è² æ•¸ -> âŒ ä¸åˆæ ¼";
        let s2Text = "";
        if(s2.value === 'sync') s2Text = "å¤–è³‡å‡ / å…§è³‡å‡ -> åŒæ­¥å¸ç±Œ";
        else if(s2.value === 'foreign_heavy') s2Text = "å¤–è³‡å‡ / å…§è³‡å¹³ -> å¤–è³‡ç¨æ’";
        else if(s2.value === 'internal_sell') s2Text = "å¤–è³‡å‡ / å…§è³‡é™ -> âŒ å…§è³‡å€’è²¨";
        else s2Text = "ç±Œç¢¼æ¸™æ•£ -> è§€æœ›";
        let s3Text = big3 ? "å‡ºç¾é—œéµä¸‰å¤§ (å¤§æ‘©/é«˜ç››/ç‘éŠ€)" : "ç„¡é¡¯è‘—çœŸä¸»åŠ›";
        // Scenario Script
        let light = indicator.dataset.light;
        let actionScript = "";
        let conclusion = "";
        if (light === "ğŸŸ¢") {
            actionScript = `1. é€²æ”» (Long)ï¼šä¸‰æŠŠåŠåˆæ ¼ï¼Œè‹¥çªç ´ NH (${nh}) ä¸”å…§è³‡æœªè·‘ï¼Œé †å‹¢æ“ä½œã€‚\n2. é˜²å®ˆï¼šå®ˆä½ NL (${nl})ã€‚`;
            conclusion = `[å¼·çƒˆå»ºè­°é€²å ´]ï¼›ä¸»åŠ›è¶¨å‹¢ç¢ºç«‹ï¼Œå®ˆä½ ${nl} çºŒæŠ±ï¼Œè¦‹ ${ah} ç²åˆ©ã€‚`;
        } else if (light === "ğŸŸ¡") {
            actionScript = `1. é€²æ”»ï¼šä¸å»ºè­°è¿½é«˜ï¼Œåƒ…ä½æ¥ã€‚\n2. é˜²å®ˆ/æ”¾ç©º (Short)ï¼šè‹¥è¦‹ AH (${ah}) ä¸éå¯å˜—è©¦çŸ­ç©º (éš”æ—¥æ²–è³£å£“)ã€‚`;
            conclusion = `[è§€æœ›/çŸ­ç·šæ“ä½œ]ï¼›ç•™æ„éš”æ—¥æ²–è³£å£“ï¼Œåš´ç¦è¿½åƒ¹ï¼Œå€é–“æ“ä½œã€‚`;
        } else {
            actionScript = `1. é€²æ”»ï¼šç¦æ­¢ã€‚\n2. é˜²å®ˆï¼šè·Œç ´ NL (${nl}) ç„¡æ¢ä»¶åœæï¼Œç”šè‡³åæ‰‹åšç©ºã€‚`;
            conclusion = `[å»ºè­°æ”¾ç©º/å‡ºå ´]ï¼›ç±Œç¢¼çµæ§‹è½‰å¼±ï¼Œåš´æ ¼åŸ·è¡Œ AL (${al}) åœæã€‚`;
        }
        // Final Text Block
        let report = `## ğŸ¯ [${name}] è–åŠçŸ³æ¥µé€Ÿè¨ºæ–·å ±å‘Š
### ä¸€ã€ æˆ°ç•¥å±¤ï¼šä¸‰æŠŠåŠæª¢æ ¸
- ç¬¬ä¸€åŠ (é‡‘æµ)ï¼š${s1Text}
- ç¬¬äºŒåŠ (çµæ§‹)ï¼š${s2Text}
- ç¬¬ä¸‰åŠ (è¡€çµ±)ï¼š${s3Text}
### äºŒã€ æˆ°è¡“å±¤ï¼šçŸ³é ­æˆ°æ³•ç¶²æ ¼
- AH (æ¥µé™å£“)ï¼š${ah} -> ä¹–é›¢éå¤§ï¼Œå¤šå–®ç²åˆ©ï¼Œç©ºå–®å˜—è©¦
- NH (è¿½æ“Šé»)ï¼š${nh} -> çªç ´ä¸”é‡å¢ï¼Œè¦–ç‚ºç™¼å‹•é»
- CDP (ä¸­è»¸)ï¼š${cdp} -> å¤šç©ºåˆ†æ°´å¶ºï¼Œç«™ç©©åå¤š
- NL (é˜²å®ˆé»)ï¼š${nl} -> å¤šé ­é‡è¦æ”¯æ’ï¼Œè·Œç ´è½‰å¼±
- AL (åœæé»)ï¼š${al} -> æœ€å¾Œé˜²ç·šï¼Œè·Œç ´ç„¡æ¢ä»¶é›¢å ´
### ä¸‰ã€ ç±Œç¢¼é›·é”èˆ‡ç‡ˆè™Ÿ
- ç¸½é«”ç‡ˆè™Ÿï¼š${indicator.innerText}
- é—œéµåˆ¸å•†è§£æï¼š
  ${brokerNotes} ${highRisk ? "(âš ï¸å«é«˜é¢¨éšªä¸»åŠ›)" : ""}
### å››ã€ ä½œæˆ°åŠ‡æœ¬
${actionScript}
### äº”ã€ çµèª
ã€Œ${conclusion}ã€`;
        document.getElementById('outputReport').value = report;
    }
    function copyReport() {
        let copyText = document.getElementById("outputReport");
        copyText.select();
        copyText.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(copyText.value);
        alert("å ±å‘Šå·²è¤‡è£½ï¼");
    }
</script>
</body>
</html>
